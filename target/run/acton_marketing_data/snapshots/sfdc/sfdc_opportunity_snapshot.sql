
      update "acton"."snapshots"."sfdc_opportunity_snapshot2"
    set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to
    from "sfdc_opportunity_snapshot2__dbt_tmp160528550258" as DBT_INTERNAL_SOURCE
    where DBT_INTERNAL_SOURCE.dbt_scd_id::text = "acton"."snapshots"."sfdc_opportunity_snapshot2".dbt_scd_id::text
      and DBT_INTERNAL_SOURCE.dbt_change_type::text in ('update'::text, 'delete'::text)
      and "acton"."snapshots"."sfdc_opportunity_snapshot2".dbt_valid_to is null;

    insert into "acton"."snapshots"."sfdc_opportunity_snapshot2" ("opportunity_id", "is_deleted", "account_id", "account_global_region", "company_size_rev", "opportunity_name", "stage_name", "amount", "type", "opp_lead_source", "is_closed", "is_won", "owner_id", "created_day", "created_date", "last_modified_date", "systemmodstamp", "contact_id", "contract_id", "opp_crm", "renewal_type", "renewal_acv", "opp_channel_lead_creation", "opp_medium_lead_creation", "discovery_date", "negotiation_date", "demo_date", "solution_date", "confirmed_value_date", "closing_date", "implement_date", "sql_date", "voc_date", "opp_channel_opportunity_creation", "opp_medium_opportunity_creation", "opp_content_opportunity_creation", "opp_source_opportunity_creation", "csm", "marketing_channel", "opp_channel_first_touch", "opp_content_first_touch", "opp_medium_first_touch", "opp_source_first_touch", "opp_offer_asset_type_opportunity_creation", "opp_offer_asset_subtype_opportunity_creation", "opp_offer_asset_topic_opportunity_creation", "opp_offer_asset_name_opportunity_creation", "opp_offer_asset_name_first_touch", "opp_offer_asset_name_lead_creation", "opp_offer_asset_subtype_first_touch", "opp_offer_asset_subtype_lead_creation", "opp_offer_asset_topic_first_touch", "opp_offer_asset_topic_lead_creation", "opp_offer_asset_type_first_touch", "opp_offer_asset_type_lead_creation", "opp_subchannel_first_touch", "opp_subchannel_lead_creation", "opp_subchannel_opportunity_creation", "discovery_call_date", "opportunity_status", "sql_status_reason", "sql_day", "discovery_call_scheduled_datetime", "discovery_call_completed_datetime", "ao_account_id", "lead_id_converted_from", "close_date", "opp_type_details", "close_day", "opp_source_lead_creation", "opp_campaign_opportunity_creation", "forecast_category", "opp_campaign_first_touch", "acv_deal_size_override", "lead_grade_at_conversion", "renewal_stage", "created_by_id", "quota_credit_renewal", "renewed_contract_id", "quota_credit", "primary_quote_id", "quota_credit_new_business", "quota_credit_one_time", "submitted_for_approval", "acv_add_back", "trigger_renewal_value", "sbqq_primary_quote", "sbqq_product_subscription_term", "contract_acv", "industry", "industry_bucket", "include_in_acv_deal_size", "age", "one_time_ps_value", "one_time_license_value", "pso_recurring_fees", "tcv", "acv", "total_price", "annual_price", "acv_formula", "segment", "acv_deal_size_usd", "deal_size_range", "channel_bucket", "dbt_updated_at", "dbt_valid_from", "dbt_valid_to", "dbt_scd_id")
    select DBT_INTERNAL_SOURCE."opportunity_id",DBT_INTERNAL_SOURCE."is_deleted",DBT_INTERNAL_SOURCE."account_id",DBT_INTERNAL_SOURCE."account_global_region",DBT_INTERNAL_SOURCE."company_size_rev",DBT_INTERNAL_SOURCE."opportunity_name",DBT_INTERNAL_SOURCE."stage_name",DBT_INTERNAL_SOURCE."amount",DBT_INTERNAL_SOURCE."type",DBT_INTERNAL_SOURCE."opp_lead_source",DBT_INTERNAL_SOURCE."is_closed",DBT_INTERNAL_SOURCE."is_won",DBT_INTERNAL_SOURCE."owner_id",DBT_INTERNAL_SOURCE."created_day",DBT_INTERNAL_SOURCE."created_date",DBT_INTERNAL_SOURCE."last_modified_date",DBT_INTERNAL_SOURCE."systemmodstamp",DBT_INTERNAL_SOURCE."contact_id",DBT_INTERNAL_SOURCE."contract_id",DBT_INTERNAL_SOURCE."opp_crm",DBT_INTERNAL_SOURCE."renewal_type",DBT_INTERNAL_SOURCE."renewal_acv",DBT_INTERNAL_SOURCE."opp_channel_lead_creation",DBT_INTERNAL_SOURCE."opp_medium_lead_creation",DBT_INTERNAL_SOURCE."discovery_date",DBT_INTERNAL_SOURCE."negotiation_date",DBT_INTERNAL_SOURCE."demo_date",DBT_INTERNAL_SOURCE."solution_date",DBT_INTERNAL_SOURCE."confirmed_value_date",DBT_INTERNAL_SOURCE."closing_date",DBT_INTERNAL_SOURCE."implement_date",DBT_INTERNAL_SOURCE."sql_date",DBT_INTERNAL_SOURCE."voc_date",DBT_INTERNAL_SOURCE."opp_channel_opportunity_creation",DBT_INTERNAL_SOURCE."opp_medium_opportunity_creation",DBT_INTERNAL_SOURCE."opp_content_opportunity_creation",DBT_INTERNAL_SOURCE."opp_source_opportunity_creation",DBT_INTERNAL_SOURCE."csm",DBT_INTERNAL_SOURCE."marketing_channel",DBT_INTERNAL_SOURCE."opp_channel_first_touch",DBT_INTERNAL_SOURCE."opp_content_first_touch",DBT_INTERNAL_SOURCE."opp_medium_first_touch",DBT_INTERNAL_SOURCE."opp_source_first_touch",DBT_INTERNAL_SOURCE."opp_offer_asset_type_opportunity_creation",DBT_INTERNAL_SOURCE."opp_offer_asset_subtype_opportunity_creation",DBT_INTERNAL_SOURCE."opp_offer_asset_topic_opportunity_creation",DBT_INTERNAL_SOURCE."opp_offer_asset_name_opportunity_creation",DBT_INTERNAL_SOURCE."opp_offer_asset_name_first_touch",DBT_INTERNAL_SOURCE."opp_offer_asset_name_lead_creation",DBT_INTERNAL_SOURCE."opp_offer_asset_subtype_first_touch",DBT_INTERNAL_SOURCE."opp_offer_asset_subtype_lead_creation",DBT_INTERNAL_SOURCE."opp_offer_asset_topic_first_touch",DBT_INTERNAL_SOURCE."opp_offer_asset_topic_lead_creation",DBT_INTERNAL_SOURCE."opp_offer_asset_type_first_touch",DBT_INTERNAL_SOURCE."opp_offer_asset_type_lead_creation",DBT_INTERNAL_SOURCE."opp_subchannel_first_touch",DBT_INTERNAL_SOURCE."opp_subchannel_lead_creation",DBT_INTERNAL_SOURCE."opp_subchannel_opportunity_creation",DBT_INTERNAL_SOURCE."discovery_call_date",DBT_INTERNAL_SOURCE."opportunity_status",DBT_INTERNAL_SOURCE."sql_status_reason",DBT_INTERNAL_SOURCE."sql_day",DBT_INTERNAL_SOURCE."discovery_call_scheduled_datetime",DBT_INTERNAL_SOURCE."discovery_call_completed_datetime",DBT_INTERNAL_SOURCE."ao_account_id",DBT_INTERNAL_SOURCE."lead_id_converted_from",DBT_INTERNAL_SOURCE."close_date",DBT_INTERNAL_SOURCE."opp_type_details",DBT_INTERNAL_SOURCE."close_day",DBT_INTERNAL_SOURCE."opp_source_lead_creation",DBT_INTERNAL_SOURCE."opp_campaign_opportunity_creation",DBT_INTERNAL_SOURCE."forecast_category",DBT_INTERNAL_SOURCE."opp_campaign_first_touch",DBT_INTERNAL_SOURCE."acv_deal_size_override",DBT_INTERNAL_SOURCE."lead_grade_at_conversion",DBT_INTERNAL_SOURCE."renewal_stage",DBT_INTERNAL_SOURCE."created_by_id",DBT_INTERNAL_SOURCE."quota_credit_renewal",DBT_INTERNAL_SOURCE."renewed_contract_id",DBT_INTERNAL_SOURCE."quota_credit",DBT_INTERNAL_SOURCE."primary_quote_id",DBT_INTERNAL_SOURCE."quota_credit_new_business",DBT_INTERNAL_SOURCE."quota_credit_one_time",DBT_INTERNAL_SOURCE."submitted_for_approval",DBT_INTERNAL_SOURCE."acv_add_back",DBT_INTERNAL_SOURCE."trigger_renewal_value",DBT_INTERNAL_SOURCE."sbqq_primary_quote",DBT_INTERNAL_SOURCE."sbqq_product_subscription_term",DBT_INTERNAL_SOURCE."contract_acv",DBT_INTERNAL_SOURCE."industry",DBT_INTERNAL_SOURCE."industry_bucket",DBT_INTERNAL_SOURCE."include_in_acv_deal_size",DBT_INTERNAL_SOURCE."age",DBT_INTERNAL_SOURCE."one_time_ps_value",DBT_INTERNAL_SOURCE."one_time_license_value",DBT_INTERNAL_SOURCE."pso_recurring_fees",DBT_INTERNAL_SOURCE."tcv",DBT_INTERNAL_SOURCE."acv",DBT_INTERNAL_SOURCE."total_price",DBT_INTERNAL_SOURCE."annual_price",DBT_INTERNAL_SOURCE."acv_formula",DBT_INTERNAL_SOURCE."segment",DBT_INTERNAL_SOURCE."acv_deal_size_usd",DBT_INTERNAL_SOURCE."deal_size_range",DBT_INTERNAL_SOURCE."channel_bucket",DBT_INTERNAL_SOURCE."dbt_updated_at",DBT_INTERNAL_SOURCE."dbt_valid_from",DBT_INTERNAL_SOURCE."dbt_valid_to",DBT_INTERNAL_SOURCE."dbt_scd_id"
    from "sfdc_opportunity_snapshot2__dbt_tmp160528550258" as DBT_INTERNAL_SOURCE
    where DBT_INTERNAL_SOURCE.dbt_change_type::text = 'insert'::text;

  